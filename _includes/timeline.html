{% assign series = site.data.release['stable'] | map: "series" %}
{% assign posts = site.posts | concat: site.releases |
    sort: "date" | reverse %}

{% for post in posts limit:page.max_posts %}
    {% case post.collection %}
    {% when "posts" %}
        <h4>{{ post.title }} ({{ post.date | date: "%b %d %Y" }})</h4>
        {{ post.content }}
    {% when "releases" %}
        {% assign release = post %}
        {% if release.draft %} {% continue %} {% endif %}
        {% if series contains release.series or page.max_posts == nil %}
        {% else %} {% continue %} {% endif %}
        <h4>{{ release.title }} released! ({{ release.date | date: "%b %d %Y" }})</h4>
        <ul>
        {% if release.summary %}
            <li>{{ release.summary }}.</li>
        {% endif %}
            <li>See <a href="releases/{{ release.version }}">
                {% if release.snapshot %}draft {% endif %}release notes</a>
                for details and download information.
            </li>
        {% assign excerpt = release.excerpt | strip_newlines %}
        {% if release.overview %}
            <li>Highlights include:
                {{ release.excerpt }}
            </li>
        {% endif %}
        </ul>
    {% endcase %}
{% endfor %}
